---
# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json

name: scentia-os
description: "Scentia OS – Hyprland (built from source) + LACT + Dev + Gaming + CUDA"
base-image: ghcr.io/ublue-os/bazzite-nvidia
image-version: latest

modules:

  ##########################################################
  # FILES (scripts + simple config)
  ##########################################################
  - type: files
    files:
      - source: lactd.service
        destination: /etc/systemd/system/lactd.service

      - source: environment
        destination: /etc/environment

      # build script that will compile Hyprland from source during the build
      - source: build-hyprland.sh
        destination: /usr/local/bin/build-hyprland.sh

  ##########################################################
  # DNF — runtime + developer + build dependencies
  ##########################################################
  - type: dnf
    repos:
      # Keep LACT COPR if you still want native LACT; remove it if you vendor LACT too.
      copr:
        - xnorbr/lact

    install:
      packages:
        # Developer / general tools (you asked to keep dev tools)
        - git
        - curl
        - gcc
        - gcc-c++
        - clang
        - llvm
        - make
        - cmake
        - ninja-build
        - meson
        - pkg-config
        - python3
        - python3-pip
        - python3-mako

        # Build dependencies commonly needed to compile Hyprland (Fedora names)
        - wlroots-devel
        - wayland-devel
        - wayland-protocols-devel
        - libxkbcommon-devel
        - libinput-devel
        - libseat-devel
        - libevdev-devel
        - libudev-devel
        - libdrm-devel
        - libwayland-egl-devel
        - libxkbcommon-x11-devel

        # Gaming / Wayland / Hyprland runtime tools
        - hyprland   # optional: will be overridden by local build/install (or remove this if you want only built-from-source)
        - waybar
        - rofi-wayland
        - hyprpaper
        - grim
        - slurp
        - swaylock

        # Gaming stack, Vulkan, etc.
        - gamemode
        - mangohud
        - mangohud-core
        - vkBasalt
        - vulkan-tools
        - vulkan-validation-layers

        # LACT GPU controller
        - lact

        # CUDA / AI stack (you asked for)
        - cuda
        - cuda-cudart
        - cuda-nvrtc
        - cuda-nvtx
        - libcublas
        - libcublas-devel
        - cudnn8
        - cudnn8-devel

    remove:
      packages:
        - firefox
        - firefox-langpacks

  ##########################################################
  # RUN / SCRIPT module — compile & install Hyprland from source
  # (executes after dnf/files)
  ##########################################################
  - type: run
    commands:
      - /bin/bash /usr/local/bin/build-hyprland.sh

  ##########################################################
  # (Optional) DNF cleanup: if you want to remove build-only packages,
  # add a dnf module here to remove them.  This example keeps dev
  # tools since you asked for developer tooling to remain.
  ##########################################################
  # - type: dnf
  #   remove:
  #     packages:
  #       - meson
  #       - ninja-build
  #       - python3-mako

  ##########################################################
  # FLATPAKS
  ##########################################################
  - type: default-flatpaks
    configurations:
      - scope: system
        install:
          - org.mozilla.firefox
          - org.gnome.Loupe

  ##########################################################
  # SIGNING
  ##########################################################
  - type: signing
